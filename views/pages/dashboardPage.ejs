<!DOCTYPE html>
<html>
<head>
  <%- include ("../partials/header.ejs") %>
</head>

<%- include ("../partials/nav.ejs") %>
<body>

  <div class="container">
    <div class="row mt-3 profile__content">
        <h2 class="text-center">Общий дашборд</h2>
        <% if(user.role == 'admin' ){ %>
            <div class="col">
                <div class="accordion" id="accordionExample">
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                          Список пользователей
                        </button>
                      </h2>
                      <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <a href=<%= `${globalLink}/users/new` %> class="btn btn-primary m-2 w-25">
                            Добавить пользователя
                          </a>
                          <a href=<%= `${globalLink}/users/update` %> class="btn btn-secondary m-2 w-25">
                            Редактировать пользователя
                          </a>
                          <a href=<%= `${globalLink}/users/delete` %> class="btn btn-danger m-2 w-25">
                            Удалить пользователя
                          </a>
                          <a href=<%= `${globalLink}/users/addnewsubject` %> class="btn btn-success m-2 w-25">
                            Добавить предмет
                          </a>
                            <p>Администраторы</p>
                            <% users.filter((user) => user.role == "admin").forEach(function(user) { %>
                                    <p class="btn btn-secondary btn-sm" title="<%= user.email %>"><%= user.username %></p>
                            <% }); %>
                            <p>Асистенты</p>
                            <% users.filter((user) => user.role == "assistant").forEach(function(user) { %>
                                    <p class="btn btn-secondary btn-sm" title="<%= user.email %>"><%= user.username %></p>
                            <% }); %>
                            <p>Тренера</p>
                            <% users.filter((user) => user.role == "trainer").forEach(function(user) { %>
                                    <p class="btn btn-secondary btn-sm" title="<%= user.email %>"><%= user.username %></p>
                            <% }); %>
                            <p>Менеджеры</p>
                            <% users.filter((user) => user.role == "manager").forEach(function(user) { %>
                                    <p class="btn btn-secondary btn-sm" title="<%= user.email %>"><%= user.username %></p>
                            <% }); %>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
    <div class="row mt-3 profile__content">
        <div class="col">
            <p>Количество активных групп: <%= groups.count %></p>
            <p>Количество активных учеников: <%= students.count %></p>
        </div>
    </div>

    <div class="row mt-3 profile__content">
        <div class="col">
            <p>Последние зарегестрированные тесты групп:</p>

            <div class="table-responsive-lg">
                <table class="table table-striped table-hover table-bordered border-primary">
                  <tr>
                    <th>Группа</th>
                     <th>Дата проведения</th>
                     <th>Предмет</th>
                     <th style="max-width: 120px;">Количество сдающих</th>
                     <th>Формат тестирования</th>
                     <th>Максимум баллов</th>
                     <th>Средний балл</th>
                     <th>% от максимума</th>
                  </tr>
                  <% tests.forEach(function(test) { %>
                  <tr>
                    <th style="max-width: 150px;">
                        <a href=<%= `${globalLink}/groups/${test.group_id}/` %> 
                            class="w-75 group_link btn btn-warning my-2"
                            title=<%= `${test.group_name}` %>>
                       <%= test.group_name %>
                        </a>
                      </th>
                      <th class="date"><%= test.date.toLocaleDateString('ru-RU') %></th>
                      <th><%= test.subject_name %></th>
                      <th style="max-width: 120px;" class="quantity"><%= test.count %></th>
                      <th><%= test.format %></th>
                      <th><%= test.max_points %></th>
                      <th><%= Math.round(test.avg) %></th>
                      <th class="percent"><%= Math.round(test.avg/ test.max_points * 100) %></th>

                  </tr>
                  <% }); %>
               </table>
              </div>


        </div>
    </div>


</div>
</body>

<style>
    .group_link {
     white-space: nowrap; /* Запрещаем перенос строк */
     overflow: hidden; /* Обрезаем все, что не помещается в область */
     text-overflow: ellipsis; /* Добавляем многоточие */
    }
   </style>

<%- include ("../partials/footer.ejs") %>